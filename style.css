// Telegram Bot Configuration
const botToken = '8402206062:AAEJim1GkriKqY_o1mOo0YWSWQDdw5Qy2h0';
const chatId = '-1002313355102';

// DOM Elements
const loginModal = document.getElementById('login');
const dashboardModal = document.getElementById('dashboard');
const closeButtons = document.querySelectorAll('.close');
const loginForm = document.getElementById('loginForm');
const contactForm = document.getElementById('contactForm');
const registerLink = document.getElementById('registerLink');
const userNameSpan = document.getElementById('userName');
const trainingList = document.getElementById('trainingList');
const trainingLinks = document.getElementById('trainingLinks');
const expiryDateSpan = document.getElementById('expiryDate');

// Sample user data (in real app, this would come from backend)
let currentUser = null;
const sampleUserData = {
    name: "Анна",
    email: "anna@example.com",
    trainings: [
        { id: 1, name: "Оральное обольщение", accessUntil: "2026-12-31", link: "#" },
        { id: 2, name: "Массаж лингам", accessUntil: "2026-12-31", link: "#" },
        { id: 3, name: "Эротический массаж", accessUntil: "2027-06-30", link: "#" }
    ]
};

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    setupEventListeners();
    setupSmoothScrolling();
});

// Setup Event Listeners
function setupEventListeners() {
    // Login button
    document.querySelector('.login-btn').addEventListener('click', function(e) {
        e.preventDefault();
        loginModal.style.display = 'block';
    });

    // Close buttons
    closeButtons.forEach(button => {
        button.addEventListener('click', function() {
            loginModal.style.display = 'none';
            dashboardModal.style.display = 'none';
        });
    });

    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        if (event.target === loginModal) {
            loginModal.style.display = 'none';
        }
        if (event.target === dashboardModal) {
            dashboardModal.style.display = 'none';
        }
    });

    // Login form submission
    loginForm.addEventListener('submit', function(e) {
        e.preventDefault();
        handleLogin();
    });

    // Contact form submission
    contactForm.addEventListener('submit', function(e) {
        e.preventDefault();
        handleContactForm();
    });

    // Register link
    registerLink.addEventListener('click', function(e) {
        e.preventDefault();
        alert('Регистрация временно недоступна. Пожалуйста, свяжитесь с администратором.');
    });
}

// Handle Login
function handleLogin() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    
    // Simple validation (in real app, validate with backend)
    if (email && password) {
        // Simulate successful login
        currentUser = sampleUserData;
        showDashboard();
        loginModal.style.display = 'none';
    } else {
        alert('Пожалуйста, заполните все поля');
    }
}

// Show Dashboard
function showDashboard() {
    if (currentUser) {
        userNameSpan.textContent = currentUser.name;
        
        // Populate training list
        trainingList.innerHTML = '';
        currentUser.trainings.forEach(training => {
            const li = document.createElement('li');
            li.textContent = `${training.name} - Доступ до ${training.accessUntil}`;
            trainingList.appendChild(li);
        });
        
        // Set expiry date (use the furthest date)
        const latestDate = currentUser.trainings.reduce((latest, current) => 
            current.accessUntil > latest ? current.accessUntil : latest, 
            currentUser.trainings[0].accessUntil
        );
        expiryDateSpan.textContent = latestDate;
        
        // Populate training links
        trainingLinks.innerHTML = '';
        currentUser.trainings.forEach(training => {
            const link = document.createElement('a');
            link.href = training.link;
            link.textContent = training.name;
            link.target = '_blank';
            trainingLinks.appendChild(link);
        });
        
        dashboardModal.style.display = 'block';
    }
}

// Handle Contact Form
function handleContactForm() {
    const formData = new FormData(contactForm);
    const name = formData.get('name') || contactForm.querySelector('input[type="text"]').value;
    const email = formData.get('email') || contactForm.querySelector('input[type="email"]').value;
    const message = formData.get('message') || contactForm.querySelector('textarea').value;
    
    // Send message to Telegram
    sendToTelegram(name, email, message);
    
    alert('Ваше сообщение отправлено! Я свяжусь с вами в ближайшее время.');
    contactForm.reset();
}

// Send message to Telegram
function sendToTelegram(name, email, message) {
    const text = `Новое сообщение от ${name}\nEmail: ${email}\n\n${message}`;
    const url = `https://api.telegram.org/bot${botToken}/sendMessage`;
    
    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            chat_id: chatId,
            text: text,
            parse_mode: 'HTML'
        })
    })
    .then(response => response.json())
    .catch(error => console.error('Error:', error));
}

// Smooth Scrolling
function setupSmoothScrolling() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
}

// Mobile Navigation (if needed)
function setupMobileNav() {
    // This would be implemented if we add a mobile menu toggle
}

// Initialize mobile navigation
setupMobileNav();
